@import "variables-mixins";

/*
Because we have to respond to CSS breakpoints and JS telling we need to collapse
a nav section when there isn't enough room the navigation layout states per 'layout state'
are easier managed in mixins that DO NOT depend on the cascade.

Any style that is important to that layout state should be explicitly set and can't depend on
styles from previous breakpoints.

See mixin blocks before selectors that contain the selector name and the three layout states:

--mobile: Both the secondary links and main menu are collapsed

--collapsed-menu: Just the main menu is collapsed

--desktop: Neither are collapsed

*/

* {
  &,
  &:before,
  &:after {
    box-sizing: border-box;
  }
}

:host {
  // Example local variable, using BEM format
  // --pfe-navigation--Property: value;

  display: block;
}

:host([hidden]) {
  display: none;
}

.pfe-navigation {
  display: flex;
  align-items: stretch;
}

// Layout changes per breakpoint
// See comment at top of file
@mixin pfe-navigation__wrapper--mobile {
  margin: 0 0 8px;
  padding: 0 16px;
}
@mixin pfe-navigation__wrapper--collapsed-menu {
  margin: 0;
  padding: 0 16px;
}
@mixin pfe-navigation__wrapper--desktop {
  margin: 0;
  padding: 0 32px;
}
.pfe-navigation__wrapper {
  @include pfe-navigation__wrapper--mobile;
  position: relative;
  display: flex;
  align-items: stretch;
  height: $menu-height;
  font-size: 16px;
  line-height: 1.5;
  font-family: "RedHatText", "Red Hat Text", Overpass, Arial, Helvetica, sans-serif;
  color: #fff;
  background: #151515;
  @include breakpoint('secondary-links-expand') {
    @include pfe-navigation__wrapper--collapsed-menu;
  }
  @include breakpoint('nav-expand') {
    @include pfe-navigation__wrapper--desktop;
  }
  @include collapse('nav') {
    @include pfe-navigation__wrapper--collapsed-menu;
  }
  @include collapse('secondary-links') {
    @include pfe-navigation__wrapper--mobile;
  }

  a {
    text-decoration: none;
  }
}

// Logo area
// --------------------------------------------------------
.pfe-navigation__logo-wrapper {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  margin: 0;
  padding: 10px 16px 10px 0;
}

.pfe-navigation__logo-link {
  display: block;
  padding: 6px 8px;
  margin-left: -8px; // Should be flush left with container
}

.pfe-navigation__logo-image {
  display: block;
  width: auto;
  height: 40px;

  // In case there isn't a mobile and desktop version
  &:only-child {
    display: block;
  }
}

.pfe-navigation__logo-image--small {
  height: 32px;
}

// Top Level Menu Buttons Base Styles
// --------------------------------------------------------
.pfe-navigation__menu-toggle,
.pfe-navigation__search-toggle,
.pfe-navigation__all-red-hat-toggle,
.pfe-navigation__log-in-link {
  @include top-level-button;
}

// Add back some styles to links that stay in the menu at mobile
.pfe-navigation__menu-toggle,
.pfe-navigation__log-in-link {
  flex-direction: column;
  justify-content: center;
  margin-right: 8px;
  padding-left: 8px;
  padding-right: 8px;
  color: #fff;

  &:hover,
  &:focus {
    box-shadow: inset 0 4px 0 0 #e00;
  }

  &:before {
    margin: 0 0 4px;
  }
}

// Layout changes per breakpoint
// See comment at top of file
@mixin pfe-navigation__menu-toggle--mobile {
  display: flex;
  margin: 0 0 0 auto;
}
@mixin pfe-navigation__menu-toggle--collapsed-menu {
  display: flex;
  margin: 0 auto 0 0;
}
@mixin pfe-navigation__menu-toggle--desktop {
  display: none;
}
.pfe-navigation__menu-toggle {
  @include pfe-navigation__menu-toggle--mobile;

  @include breakpoint('secondary-links-expand') {
    @include pfe-navigation__menu-toggle--collapsed-menu;
  }
  @include breakpoint('nav-expand') {
    @include pfe-navigation__menu-toggle--desktop;
  }
  @include collapse('nav') {
    @include pfe-navigation__menu-toggle--collapsed-menu;
  }
  @include collapse('secondary-links') {
    @include pfe-navigation__menu-toggle--mobile;
  }

  // Active state
  [pfe-navigation-state^='main-menu'][class] & {
    color: #151515;
    background: #fff;
    box-shadow: inset 0 4px 0 0 #e00;
  }
}


// Outer menu wrapper layout
// --------------------------------------------------------
.pfe-navigation__outer-menu-wrapper,
.pfe-navigation__outer-menu-wrapper__inner {
  @include breakpoint('secondary-links-expand') {
    display: flex;
    align-items: stretch;
  }
  @include collapse('secondary-links') {
    display: block;
  }
}

// Layout changes per breakpoint
// See comment at top of file
@mixin pfe-navigation__outer-menu-wrapper--mobile {
  position: absolute;
  top: 100%;
  left: 0;
  display: none;
  width: 100%;
  height: auto;
  padding: 16px;
  background: #fff;
}
@mixin pfe-navigation__outer-menu-wrapper--collapsed-menu {
  position: static;
  display: flex;
  width: auto;
  height: auto;
  padding: 0;
  background: transparent;
}
@mixin pfe-navigation__outer-menu-wrapper--desktop {
  position: static;
  display: flex;
  width: auto;
  height: $menu-height;
  padding: 0;
  background: transparent;
}
.pfe-navigation__outer-menu-wrapper {
  @include pfe-navigation__outer-menu-wrapper--mobile;

  @include breakpoint('secondary-links-expand') {
    @include pfe-navigation__outer-menu-wrapper--collapsed-menu;
  }
  @include breakpoint('nav-expand') {
    @include pfe-navigation__outer-menu-wrapper--desktop;
  }
  @include collapse('nav') {

  }
  @include collapse('secondary-links') {
    @include pfe-navigation__outer-menu-wrapper--mobile;
  }

  [pfe-navigation-state^='main-menu'] & {
    display: block;
    @include breakpoint('secondary-links-expand') {
      display: flex;
    }
    @include collapse('secondary-links') {
      display: block;
    }
    @include collapse('nav') {
      display: block;
    }
  }
}

.pfe-navigation__outer-menu-wrapper,
.pfe-navigation__outer-menu-wrapper__inner {
  @include breakpoint('nav-expand') {
    flex-grow: 1;
  }
  @include collapse('nav') {
    flex-grow: 0;
  }
}

// Menu, List, & Items
// --------------------------------------------------------
// Layout changes per breakpoint
// See comment at top of file
@mixin pfe-navigation__menu-wrapper--mobile {
  position: static;
  display: block;
  width: 100%;
  margin: 0 0 8px;
  padding: 0;
  background: #fff;
}
@mixin pfe-navigation__menu-wrapper--collapsed-menu {
  position: absolute;
  top: 100%;
  left: 0;
  display: none;
  width: 100%;
  margin: 0;
  padding: 16px 32px;
  background: #fff;
}
@mixin pfe-navigation__menu-wrapper--desktop {
  position: static;
  display: flex;
  align-items: stretch;
  margin: 0 auto 0 0;
  padding: 0;
  background: transparent;
}
@mixin pfe-navigation__menu-wrapper--mobile--open {
  display: block;
}
@mixin pfe-navigation__menu-wrapper--collapsed-menu--open {
  display: block;
}
@mixin pfe-navigation__menu-wrapper--desktop--open {
  // Since open state is default state, re-assert default styles
  @include pfe-navigation__wrapper--desktop;
}
.pfe-navigation__menu-wrapper {
  @include pfe-navigation__menu-wrapper--mobile;
  @include breakpoint('secondary-links-expand') {
    @include pfe-navigation__menu-wrapper--collapsed-menu;
  }
  @include breakpoint('nav-expand') {
    &,
    &[class][class] {
      @include pfe-navigation__menu-wrapper--desktop;
    }
  }

  @include collapse('nav') {
    @include pfe-navigation__menu-wrapper--collapsed-menu;
  }
  @include collapse('secondary-links') {
    @include pfe-navigation__menu-wrapper--mobile;
  }

  // Open state
  [pfe-navigation-state^='main-menu'] & {
    @include pfe-navigation__menu-wrapper--mobile--open;
    @include breakpoint('secondary-links-expand') {
      @include pfe-navigation__menu-wrapper--collapsed-menu--open;
    }
    @include breakpoint('nav-expand') {
      @include pfe-navigation__menu-wrapper--desktop--open;
    }
    @include collapse('nav') {
      @include pfe-navigation__menu-wrapper--collapsed-menu--open;
    }
    @include collapse('secondary-links') {
      @include pfe-navigation__menu-wrapper--mobile--open;
    }
  }
}

// Menu
.pfe-navigation__menu,
.pfe-navigation__menu ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

.pfe-navigation__menu {
  @include breakpoint('nav-expand') {
    display: flex;
    align-items: stretch;
  }
  @include collapse('nav') {
    display: block;
  }
}

// Menu Items
.pfe-navigation__menu-item {
  $collapsed-border-top: 1px solid #d2d2d2;
  border-top: $collapsed-border-top;
  @include breakpoint('nav-expand') {
    display: flex;
    align-items: stretch;
    padding: 0 4px;
    border: none;
  }
  @include collapse('nav') {
    display: block;
    padding: 0;
    border-top: $collapsed-border-top;
  }

  // Default styles for sub-nav links
  a {
    display: block;
    padding: 0.8em 24px;
  }

  &:last-child {
    $collapsed-border-bottom: 1px solid #d2d2d2;
    border-bottom: $collapsed-border-bottom;
    @include breakpoint('nav-expand') {
      border: 0;
    }
    @include collapse('nav') {
      border-bottom: $collapsed-border-bottom;
    }
  }
}

.pfe-navigation__menu-item--open {
  $collapsed-border-shadow:
    inset 4px 0 0 0 #e00,
    0 1px 2px rgba(0, 0, 0, 0.12);
  box-shadow: $collapsed-border-shadow;
  @include breakpoint('nav-expand') {
    box-shadow: none;
  }
  @include collapse('nav') {
    box-shadow: $collapsed-border-shadow;
  }
}

// Top Level Menu Links
// Layout changes per breakpoint
// See comment at top of file
@mixin pfe-navigation__menu-link--mobile {
  max-height: 9999em;
  padding: 16px 24px;
  font-size: 20px;
  font-weight: 500;
  color: #151515;
  white-space: normal;
  transition: box-shadow 0.2s;
}
@mixin pfe-navigation__menu-link--desktop {
  padding: 0 8px;
  max-height: 72px;
  font-size: 16px;
  font-weight: 400;
  color: #fff;
  white-space: nowrap;
  transition: box-shadow 0.2s;
}
.pfe-navigation__menu-link {
  // Default styles need a specificity bump to beat generic menu <a> styles
  &[class] {
    @include pfe-navigation__menu-link--mobile;
    display: flex;
    align-items: center;
    border: 1px dashed transparent;
    border-top: 0;
    @include breakpoint('nav-expand') {
      @include pfe-navigation__menu-link--desktop;
    }
  }
  @include collapse('nav') {
    @include pfe-navigation__menu-link--mobile;
  }

  &:hover,
  &:focus {
    @include breakpoint('nav-expand') {
      box-shadow: inset 0 4px 0 0 #e00;
    }
    @include collapse('nav') {
      box-shadow: none;
    }
  }

  &:focus {
    border: 1px dashed #fff;
    border-top: 0;
    outline: none;
  }
}

// Top level links that have a dropdown associated with them
.pfe-navigation__menu-link[aria-haspopup=true] {
  position: relative;
  // @todo I don't think this block is necessary? If it is it needs to be reversed in the collapse block
  // @include breakpoint('nav-expand') {
  //   box-shadow: none;
  // }
  // @include collapse('nav') {}

  &:hover,
  &:focus {
    @include breakpoint('nav-expand') {
      box-shadow: inset 0 4px 0 0 #e00;
    }
    @include collapse('nav') {
      box-shadow: none;
    }
  }

  .pfe-navigation__menu-item--open > & {
    @include breakpoint('nav-expand') {
      color: #151515;
      background: #fff;
      box-shadow: inset 0 4px 0 0 #e00;
    }
    @include collapse('nav') {
      box-shadow: none;
    }
  }
}

// Top Level menu link arrow icon (no image, made with CSS)
@mixin pfe-navigation__menu-link__before--mobile {
  position: absolute;
  top: 50%;
  left: auto;
  right: 24px;
  display: block;
  width: 11px;
  height: 11px;
  border: 4px solid #151515;
  border-bottom: 0;
  border-left: 0;
  transform: rotate(45deg);
  transform-origin: right top;
  transition: transform 0.25s;
}
@mixin pfe-navigation__menu-link__before--desktop {
  position: absolute;
  top: 100%;
  left: 50%;
  right: auto;
  width: 0;
  height: 0;
  border: 4px solid transparent;
  border-bottom: 0;
  transform: translate(-4px, -12px);
  transition: border-color 0.25s;
}
.pfe-navigation__menu-link[aria-haspopup=true]:before {
  @include pfe-navigation__menu-link__before--mobile;
  content: '';

  @include breakpoint('nav-expand') {
    @include pfe-navigation__menu-link__before--desktop;

  }
  @include collapse('nav') {
    @include pfe-navigation__menu-link__before--mobile;
  }
  &:hover:before,
  &:focus:before {
    @include breakpoint('nav-expand') {
      border-top-color: #B8BBBE;
    }
    @include collapse('nav') {
      border-top-color: #151515;
    }
  }

  .pfe-navigation__menu-item--open > &[class]:before { // [class] adds specificity to beat out hover/focus selector
    transform: rotate(135deg);
    @include breakpoint('nav-expand') {
      border-top-color: #151515;
      transform: translate(-4px, -12px);
    }
    @include collapse('nav') {
      transform: rotate(135deg);
    }
  }
}


// Main menu dropdowns
// --------------------------------------------------------

// Dropdown wrapper - used for basic layout properties and animation
@mixin pfe-navigation__dropdown-wrapper--mobile {
  width: 100%;
  overflow: hidden;
  visibility: hidden;
  height: 0;
}
@mixin pfe-navigation__dropdown-wrapper--desktop {
  @include dropdown-transitions(false);
  position: absolute;
  top: 100%;
  left: 0;
  height: 0;
  overflow: hidden;
  visibility: hidden;
}
.pfe-navigation__dropdown-wrapper {
  // @todo animation and polish
  @include pfe-navigation__dropdown-wrapper--mobile;
  @include breakpoint('nav-expand') {
    @include pfe-navigation__dropdown-wrapper--desktop;
  }
  @include collapse('nav') {
    @include pfe-navigation__dropdown-wrapper--mobile;
  }

  .pfe-navigation__menu-item--open > & {
    @include dropdown-transitions(true);
    visibility: visible;
    height: auto; // Height is set in JS, this is a fallback
    display: block;
  }
}

.pfe-navigation__dropdown-wrapper--single-column {
  @include breakpoint('nav-expand') {
    left: auto;
    width: auto;
    max-width: 100%;
    min-width: 13em; // Trying to make sure it's larger than the top level menu link
  }
  @include collapse('nav') {
    position: static;
    max-width: 100%;
  }

  .pfe-navigation__menu-item--open > & {
    display: block;
  }
}


// Dropdown contents - lays out dropdown internals
@mixin pfe-navigation__dropdown--mobile {
  display: block;
  font-size: 16px;
  padding: 0;
  background: transparent;
}
@mixin pfe-navigation__dropdown--desktop {
  display: grid;
  padding: 32px 64px;
  // Fits as many columns as it can given the constraints
  // @todo evaluate layout needs and if this is a sane default
  grid-template-columns: 
    repeat(
      auto-fill,
      minmax(#{200 / 16 * 1em}, #{350 / 16 * 1em})
    );
  grid-gap: 2em;
  background: #fff;
}
.pfe-navigation__dropdown {
  // @todo animation and polish
  @include pfe-navigation__dropdown--mobile;
  @include breakpoint('nav-expand') {
    @include pfe-navigation__dropdown--desktop;
  }
  @include collapse('nav') {
    @include pfe-navigation__dropdown--mobile;
  }

  // @todo: adjust heading spacing styles to still look good when there is no link in heading
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin: 0;
    padding: 0;
    font-size: 16px;
    color: var(--pfe-theme--color--ui-complement,#464646);
  }

  h1 a,
  h2 a,
  h3 a,
  h4 a,
  h5 a,
  h6 a {
    color: var(--pfe-theme--color--ui-complement,#464646);
  }

  li a {
    color: var(--pfe-broadcasted--link,#06c);
    &:hover {
      color: var(--pfe-broadcasted--link--hover,#036);
      text-decoration: underline;
    }
  }
}

.pfe-navigation__dropdown--single-column {
  @include breakpoint('nav-expand') {
    padding: 16px;
    background: #fff;
    box-shadow: 
      var(
        --pfe-theme--box-shadow--sm,
        0 0.0625rem 0.125rem 0 rgba(19, 19, 19, 0.2)
      );
  }
  @include collapse('nav') {
    padding: 0;
    background: transparent;
  }
}

.pfe-navigation__footer {
  $collapsed-margin: 16px;
  $collapsed-padding: 26px 8px 16px 8px;
  grid-column: 1 / -1; // col spans to the end of col grid line always

  // @todo Think this might be better off with display block by default? Maybe grid is an option?
  display: grid;
  grid-gap: 2em;
  // @todo not sure if this is what we need?
  grid-auto-flow: column;
  // @todo: figure out what mobile and desktop margin/padding should be from design and redhat.com ex
  margin: $collapsed-margin;
  padding: $collapsed-padding;
  border-top: 1px solid #d3d3d3;

  @include breakpoint('nav-expand') {
    margin: calc(var(--pfe-theme--container-padding,16px) * 2) 0 calc(var(--pfe-theme--container-padding,16px) * 1.5);
    padding: calc(var(--pfe-theme--container-padding,16px) * 2.5) 0 0; 
  }
  @include collapse('nav') {
    margin: $collapsed-margin;
    padding: $collapsed-padding;
  }
}

// Search
// --------------------------------------------------------
.pfe-navigation__search-toggle {
  display: none;
  @include breakpoint('secondary-links-expand') {
    display: flex;
  }
  @include collapse('secondary-links') {
    display: none;
  }

  [pfe-navigation-state='search--open'] & {
    color: #151515;
    background: #fff;
    box-shadow: inset 0 4px 0 0 #e00;
  }
}

@mixin pfe-navigation__search--mobile {
  position: static;
  display: block;
  width: 100%;
  margin-bottom: 24px;
  background: transparent;
}
@mixin pfe-navigation__search--collapsed-menu {
  position: absolute;
  top: 100%;
  left: 0;
  display: none;
  margin-bottom: 0;
  padding: 16px;
  background: #fff;
}
.pfe-navigation__search {
  @include pfe-navigation__search--mobile;
  color: #151515;
  @include breakpoint('secondary-links-expand') {
    @include pfe-navigation__search--collapsed-menu;
  }
  @include collapse('secondary-links') {
    @include pfe-navigation__search--mobile;
  }

  [pfe-navigation-state='search--open'][class] & { // Extra specificity to beat js breakpoints
    display: block;
  }
}

// Custom Links
// --------------------------------------------------------
.pfe-navigation__custom-links {
  @include breakpoint('secondary-links-expand') {
    display: flex;
    align-items: stretch;
  }
  @include collapse('secondary-links') {
    display: block;
  }

  &,
  a,
  button {
    color: #151515;
    @include breakpoint('secondary-links-expand') {
      color: #fff;
    }
    @include collapse('secondary-links') {
      color: #151515;
    }
  }
}

// All Red Hat Button & Dropdown
// --------------------------------------------------------
.pfe-navigation__all-red-hat-toggle {
  [pfe-navigation-state='all-red-hat--open'] & {
    color: #151515;
    background: #fff;
    box-shadow: inset 0 4px 0 0 #e00;
  }
}

.pfe-navigation__all-red-hat-wrapper__inner {
  display: none;
  width: 100%;

  @include breakpoint('secondary-links-expand') {
    position: absolute;
    top: 100%;
    left: 0;
    padding: 16px;
    color: #151515;
    background: #fff;
  }
  @include collapse('secondary-links') {
    position: static;
    padding: 0;
    color: #fff;
    background: transparent;
  }

  [pfe-navigation-state='all-red-hat--open'] & {
    @include breakpoint('secondary-links-expand') {
      display: block;
    }
  }
}

.pfe-navigation__log-in-link {
  // Stuff should go in here...
}

//-- Custom styles applied by attributes
// @each $option in () {
//   :host([pfe-state="#{$option}"]) {
//     // Add styles here
//   }
// }

//-- Custom styles applied to slot
// ::slotted([slot="pfe-navigation--search"]) {
  // Add styles here
// }

// ::slotted([slot="pfe-navigation--custom-links"]) {
  // Add styles here
// }

//-- Custom styles applied to slot's shadow element
// .pfe-navigation {
//   &__search {
    // Add styles here
//   }
//   &__custom-links {
    // Add styles here
//   }
// }